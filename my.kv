#:kivy 2.3.0
<ScreenManagement>:
    id: screen_manager
    SigninPage:
        id: sign_in
        name: 'sign_in'
    GuestScreen:
    KnowledgeScreen:
        id: knowledge
        name: 'knowledge'
        manager: screen_manager
    GeneralScreen:
    # MapWidget:
    ConnectScreen:
        id: connect_screen
        name: 'connect_screen'
        manager: screen_manager
    ChatScreen:
        id: chat_screen
        name: 'chat_screen'
        manager: screen_manager

<SigninPage>:
    name: 'sign'
    GridLayout:
        cols:1
        size: (root.width, root.height)
        padding: 10
        spacing: 10
        canvas.before:
            Color:
                rgba: 1, 1, .878,1
            Rectangle:
                size: self.size
                pos: self.pos

        Label:
            text: "Enter the Trail Code"
            font_size: '20sp'
            bold: True
            color: "#ffffff"
        TextInput:
            id: trail_code_input
            multiline:False
            size_hint_y: None
            height: '40sp'
            font_size: '16sp'
            padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]

        Button:
            text: "Continue with Trail Code"
            font_size: 36
            background_color: 0,0,0,0
            spacing: 10
            canvas.before:
                Color:
                    rgba: 34/255.0, 139/255.0, 34/255.0, 1 
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [18,]
            color: 1, 1, 1, 1
            size_hint_y: None
            height: '50sp'
            on_press: root.go_to_knowledge(trail_code_input.text)

        Button:
            text: "Continue as Guest"
            font_size: 36
            background_color: 0,0,0,0
            canvas.before:
                Color:
                    rgba: 34/255.0, 139/255.0, 34/255.0, 1 
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [18,]
            color: 1, 1, 1, 1
            size_hint_y: None
            height: '50sp'
            on_press: root.go_to_general()


<GuestScreen>
    name: 'guest'
    orientation: 'vertical'

<KnowledgeScreen>
    name: 'knowledge'
    orientation: 'vertical'
    spacing: 10
    padding: 10

    BoxLayout:
        orientation: 'vertical'
        Label:
            id: trail_code_display
            font_size: '20sp'

        GridLayout:
            cols: 2
            spacing: 30

            TextInput:
                id: alert
                text: 'Alert'
                background_color: "#ac4e48"
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
            TextInput:
                id: more_info
                text: 'More Info'
                background_color: '#8ca2ed'
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
            TextInput:
                id: weather
                text: 'Weather'
                background_color: "#7effff"
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
            TextInput:
                id: warning
                text: 'Warning'
                background_color: 1, 1, 0, 1
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
        
        BoxLayout:
            orientation: 'vertical'

            Button:
                text: 'Connect with someone else'
                size_hint_y: None
                height: '50dp'
                background_color: 0, 1, 0, 1
                color: 1, 1, 1, 1  
                font_size: '20sp'
                on_release: root.connect()

            Image:
                id: map_image
                source: None
                size_hint: (1, None)
                height: root.height * 0.2  # Set the height to 80% of the BoxLayout's height
                allow_stretch: True
        
#         MapWidget:
#             size_hint: 1, 1

# <MapWidget>:
#     canvas:
#         Color:
#             rgba: 0.3, 0.3, 0.3, 1
#         Rectangle:
#             pos: self.pos
#             size: self.size

<GeneralScreen>
    name: 'general'
    orientation: 'vertical'
    spacing: 10
    padding: 10

    AnchorLayout:  # Added anchor layout
        anchor_x: 'left'
        anchor_y: 'top'
        Button:
            text: 'Exit'
            background_color: 1, 1, 1, 1  # white color
            color: 1, 0, 0, 1  # red color
            size_hint: 0.1, 0.1
            on_release: root.exit()

    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'General Knowledge'
            font_size: '20sp'

        GridLayout:
            cols: 2
            spacing: 30

            TextInput:
                id: alert
                text: 'Be careful for this'
                background_color: "#ac4e48"
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
            TextInput:
                id: more_info
                text: 'What to bring'
                background_color: '#8ca2ed'
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
            TextInput:
                id: weather
                text: 'Types of Trail'
                background_color: "#7effff"
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10
            TextInput:
                id: warning
                text: 'Medical'
                background_color: 1, 1, 0, 1
                halign: 'center'
                padding_y: [self.height / 2.0 - (self.line_height / 2.0) * len(self._lines), 0]
                spacing: 10


<ConnectScreen>:
    username_input: username_input
    BoxLayout:
        orientation: 'vertical'
        padding: '20sp'
        spacing: '20sp'
        Label:
            size_hint_y: None
            height: '40sp'
            text: 'Enter your username:'
        TextInput:
            id: username_input
            multiline: False
        Button:
            size_hint_y: None
            height: '40sp'
            text: 'Connect'
            on_release: root.connect()

<ChatScreen>:
    chat_log: chat_log
    chat_input: chat_input
    canvas.before:
        Color:
            rgba: 0.31, 0.51, 0.28, 1  # Dark green color for the background
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        padding: '10sp'
        spacing: '5sp'
        Button:
            text: 'Disconnect'
            on_release: root.disconnect()
            size_hint_y: None
            height: '40sp'
            background_color: 1, 0, 0, 1  # Red color for the button
            color: 1, 1, 1, 1  # White color for the button text
            canvas.before:
                Color:
                    rgba: self.background_color
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [15,]
        TextInput:
            id: chat_log
            readonly: True
            background_color: 0, 0, 0, 0  # Make the background of the chat log transparent
            hint_text: "Chat log..."  # Provide a hint text for the chat log
            hint_text_color: 0.6, 0.8, 0.4, 1  # Light green hint text color
        BoxLayout:
            size_hint_y: None
            height: '40sp'
            TextInput:
                id: chat_input
                multiline: False
                background_color: 0.6, 0.8, 0.4, 1  # Light green background color for the chat input
                hint_text: "Type your message..."  # Provide a hint text for the chat input
                hint_text_color: 0.31, 0.51, 0.28, 1  # Dark green hint text color
            Button:
                text: 'Send'
                on_release: 
                    root.send_message()
                    chat_input.text = ''
                background_color: 0, 0, 1, 1  # Blue color for the button
                color: 1, 1, 1, 1  # White color for the button text
                canvas.before:
                    Color:
                        rgba: self.background_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [15,]
