#:kivy 2.3.0
<ScreenManagement>:
    id: screen_manager
    SigninPage:
        id: sign_in
        name: 'sign_in'
    GuestScreen:
    KnowledgeScreen:
        id: knowledge
        name: 'knowledge'
        manager: screen_manager
    GeneralScreen:
    # MapWidget:
    ConnectScreen:
        id: connect_screen
        name: 'connect_screen'
        manager: screen_manager
    ChatScreen:
        id: chat_screen
        name: 'chat_screen'
        manager: screen_manager

<SigninPage>:
    name: 'sign'
    GridLayout:
        cols: 1
        size: root.size
        padding: dp(20)
        spacing: dp(20)
        canvas.before:
            Color:
                rgba: 0.52, 0.73, 0.94, 1  # Light blue background color
            Rectangle:
                size: self.size
                pos: self.pos

        BoxLayout:
            orientation: 'vertical'
            spacing: dp(10)

            Label:
                text: "Enter the Trail Code"
                font_size: '24sp'
                bold: True
                color: "#ffffff"

            TextInput:
                id: trail_code_input
                multiline: False
                size_hint_y: None
                height: dp(40)
                font_size: '16sp'

        Button:
            text: "Continue with Trail Code"
            font_size: '20sp'
            background_color: 0.2, 0.6, 0.4, 1  # Green background color
            background_normal: ''
            size_hint_y: None
            height: dp(50)
            border_radius: [18, ]
            on_press: root.go_to_knowledge(trail_code_input.text)

        Button:
            text: "Continue as Guest"
            font_size: '20sp'
            background_color: 0.2, 0.6, 0.4, 1  # Green background color
            background_normal: ''
            size_hint_y: None
            height: dp(50)
            border_radius: [18, ]
            on_press: root.go_to_general()


<GuestScreen>
    name: 'guest'
    orientation: 'vertical'

<KnowledgeScreen>:
    name: 'knowledge'
    canvas.before:
        Color:
            rgba: 0.52, 0.73, 0.94, 1  # Light blue background color
        Rectangle:
            size: self.size
            pos: self.pos
    
    Label:
        id: location
        text: "Cherry Creek Trail"
        pos_hint: {"center_x": .5, "center_y": .90}
        halign: "center"
        font_size: "20sp" 
    Button:
        text: 'Exit'
        background_color: 1, 1, 1, 1  # white color
        color: 1, 0, 0, 1  # red color
        size_hint: 0.1, 0.1
        pos_hint: {"center_x": .10, "center_y": .90}
        on_release: root.exit()   
    Image:
        id: sum_image
        source: 'sunny.png'
        size_hint_y: None
        allow_stretch: True
        pos_hint: {"center_x": .25, "center_y": .80}
    Label:
        id: weather_condition
        text: "Sunny"
        pos_hint: {"center_x": .25, "center_y": .70}
        halign: "center"
        font_size: "20sp"

    Image:
        id: hot_temp_image
        source: 'hot_temp.png'
        size_hint_y: None
        allow_stretch: True
        pos_hint: {"center_x": .73, "center_y": .80}
    Label:
        id: temperature
        text: "96Â°"
        pos_hint: {"center_x": .73, "center_y": .70}
        halign: "center"
        font_size: "20sp"

    Image:
        id: visibility_image
        source: 'visibility.png'
        size_hint_y: None
        allow_stretch: True
        pos_hint: {"center_x": .25, "center_y": .60}
    Label:
        id: visibility
        text: "24%"
        pos_hint: {"center_x": .25, "center_y": .50}
        halign: "center"
        font_size: "20sp"
     
    Image:
        id: wind_image
        source: 'wind-speed.png'
        size_hint_y: None
        allow_stretch: True
        pos_hint: {"center_x": .73, "center_y": .60}
    Label:
        id: wind
        text: "2.68"
        pos_hint: {"center_x": .73, "center_y": .50}
        halign: "center"
        font_size: "20sp"
    
    Image:
        id: location_image
        source: 'location.png'
        size_hint_y: None
        allow_stretch: True
        pos_hint: {"center_x": .25, "center_y": .40}
    Label:
        id: city
        text: "2.68"
        pos_hint: {"center_x": .25, "center_y": .30}
        halign: "center"
        font_size: "20sp"

    Label:
        id: prediction
        text: "2.68"
        pos_hint: {"center_x": .50, "center_y": .20}
        halign: "center"
        font_size: "20sp"

    BoxLayout:
        orientation: 'vertical'
        
        Button:
            text: 'Connect with someone else'
            font_size: '20sp'
            background_color: 0.2, 0.6, 0.4, 1  # Green background color
            background_normal: ''
            size_hint_y: None
            height: dp(50)
            border_radius: [18, ]
            on_release: root.connect()

        Button:
            id: map_button
            text: 'Show Map'
            font_size: '20sp'
            background_color: 0.2, 0.6, 0.4, 1  # Green background color
            background_normal: ''
            size_hint_y: None
            height: dp(50)
            border_radius: [18, ]
            on_release: root.toggle_map()

        MapView:
            id: mapview
            lat: root.map_lat
            lon: root.map_lon
            zoom: 50
            size_hint_y: None
            height: 0 if not root.show_map else dp(300)  # Set height to 0 if map is hidden
            opacity: 1 if root.show_map else 0 

<GeneralScreen>:
    name: 'general'
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)
        Button:
            text: 'Exit'
            background_color: 1, 1, 1, 1  # white color
            color: 1, 0, 0, 1  # red color
            size_hint: 0.1, 0.1
            on_release: root.exit()
        Label:
            text: 'General Knowledge'
            font_size: '20sp'

        GridLayout:
            cols: 2
            spacing: dp(20)

            TextInput:
                id: alert
                text: 'Be careful for this'
                background_color: "#FF7E79"  # Red background color for alert
                halign: 'center'
                padding_y: dp(self.height / 2.0 - (self.line_height / 2.0) * len(self._lines))
            TextInput:
                id: more_info
                text: 'What to bring'
                background_color: '#A9C7FF'  # Blue background color for more info
                halign: 'center'
                padding_y: dp(self.height / 2.0 - (self.line_height / 2.0) * len(self._lines))
            TextInput:
                id: weather
                text: 'Types of Trail'
                background_color: "#ABD7FF"  # Light blue background color for weather
                halign: 'center'
                padding_y: dp(self.height / 2.0 - (self.line_height / 2.0) * len(self._lines))
            TextInput:
                id: warning
                text: 'Medical'
                background_color: "#FFFF00"  # Yellow background color for warning
                halign: 'center'
                padding_y: dp(self.height / 2.0 - (self.line_height / 2.0) * len(self._lines))


<ConnectScreen>:
    username_input: username_input
    BoxLayout:
        orientation: 'vertical'
        padding: dp(20)
        spacing: dp(20)
        Button:
            text: 'Exit'
            background_color: 1, 1, 1, 1  # white color
            color: 1, 0, 0, 1  # red color
            size_hint: 0.1, 0.1
            on_release: root.exit()
        Label:
            size_hint_y: None
            height: '40sp'
            text: 'Enter your username:'
        TextInput:
            id: username_input
            multiline: False
            background_color: "#FFFFFF"  # White background color for input
            foreground_color: "#000000"  # Black text color
        Button:
            font_size: '20sp'
            background_color: 0.2, 0.6, 0.4, 1  # Green background color
            background_normal: ''
            size_hint_y: None
            height: dp(50)
            border_radius: [18, ]
            text: 'Connect'
            on_release: root.connect()

<ChatScreen>:
    chat_log: chat_log
    chat_input: chat_input
    BoxLayout:
        orientation: 'vertical'
        padding: dp(10)
        spacing: dp(5)
        Button:
            text: 'Disconnect'
            on_release: root.disconnect()
            size_hint_y: None
            height: '40sp'
            background_color: "#FF5733"  # Orange background color for button
            color: 1, 1, 1, 1  # White text color
        TextInput:
            id: chat_log
            readonly: True
            background_color: "#00000000"  # Transparent background for chat log
            hint_text: "Chat log..."  # Hint text for chat log
            hint_text_color: "#99CC99"  # Light green hint text color
        BoxLayout:
            size_hint_y: None
            height: '40sp'
            TextInput:
                id: chat_input
                multiline: False
                background_color: "#99CC99"  # Light green background color for chat input
                hint_text: "Type your message..."  # Hint text for chat input
                hint_text_color: "#1F7D35"  # Dark green hint text color
            Button:
                text: 'Send'
                on_release: 
                    root.send_message()
                    chat_input.text = ''
                background_color: "#3E8EDE"  # Blue background color for button
                color: 1, 1, 1, 1  # White text color
        
        Button:
            text: 'Exit'
            background_color: 1, 1, 1, 1  # White background color for button
            color: 1, 0, 0, 1  # Red text color
            size_hint_y: None
            height: '40sp'
            on_release: root.go_to_signin()  # Function to go back to SigninScreen
